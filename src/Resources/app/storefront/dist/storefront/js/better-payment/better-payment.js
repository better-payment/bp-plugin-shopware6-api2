(()=>{"use strict";let{PluginBaseClass:e}=window,t=["postalAddress","email","phone"],{PluginBaseClass:o}=window,n=window.PluginManager;n.register("ApplePayPlugin",class extends e{init(){this.el.addEventListener("click",this.onClick.bind(this)),this.orderForm=document.getElementById("confirmOrderForm")}showErrorMessage(){let e=document.getElementById("betterpayment-apple-pay-error");e.style.display="block",e.scrollIntoView({block:"start"})}onClick(){if(!this.orderForm.reportValidity())return;let e=this.options.initialData,o=this.options.amount;try{let n={countryCode:e.countryCode,currencyCode:e.currency,merchantCapabilities:e.applePay.merchantCapabilities,supportedNetworks:e.applePay.supportedNetworks,total:{label:e.shopName,amount:o},requiredShippingContactFields:t,requiredBillingContactFields:t},a=new ApplePaySession(14,n);a.onvalidatemerchant=()=>{fetch(this.options.validateMerchantPath,{method:"POST"}).then(e=>e.json()).then(e=>{let t=JSON.parse(atob(e.applepay_payment_session_token));a.completeMerchantValidation(t)}).catch(e=>{this.showErrorMessage()})},a.onpaymentmethodselected=()=>{let t={newTotal:{label:e.shopName,amount:o}};a.completePaymentMethodSelection(t)},a.onpaymentauthorized=async t=>{var n,i,s;let l=this.options.billingAddress,r=this.options.shippingAddress,p={applepay_token:btoa(JSON.stringify((n=t.payment)===null||void 0===n?void 0:n.token)),amount:o,currency:e.currency,postback_url:e.postback_url,shipping_costs:e.shippingCosts,vat:e.vat,order_id:e.orderId,merchant_reference:e.orderId+" - "+e.shopName,customer_id:e.customerId,customer_ip:e.customerIp,app_name:e.appName,app_version:e.appVersion,address:l.street,city:l.city,postal_code:l.zipcode,state:(i=l.countryState)===null||void 0===i?void 0:i.name,country:l.country.iso,first_name:l.firstName,last_name:l.lastName,email:e.email,phone:l.phoneNumber,shipping_address:r.street,shipping_city:r.city,shipping_postal_code:r.zipcode,shipping_state:(s=r.countryState)===null||void 0===s?void 0:s.name,shipping_country:r.country.iso,shipping_first_name:r.firstName,shipping_last_name:r.lastName},d=await fetch(this.options.processPaymentPath,{method:"POST",body:JSON.stringify(p),headers:{"Content-Type":"application/json"}});if(d.ok){let e=await d.json();0===e.error_code?(a.completePayment({status:ApplePaySession.STATUS_SUCCESS}),document.getElementById("betterpayment_apple_pay_transaction_id").value=e.transaction_id,document.getElementById("betterpayment_apple_pay_transaction_status").value=e.status,this.orderForm.submit()):(a.completePayment({status:ApplePaySession.STATUS_FAILURE}),this.showErrorMessage())}else a.completePayment({status:ApplePaySession.STATUS_FAILURE}),this.showErrorMessage()},a.oncancel=e=>{this.showErrorMessage()},a.begin()}catch(e){this.showErrorMessage()}}},"[data-apple-pay-plugin]"),n.register("GooglePayPlugin",class extends o{async init(){var e,t;if(await new Promise(e=>setTimeout(e,1e3)),!((e=this.options)===null||void 0===e?void 0:e.initialData))return;this.orderForm=document.getElementById("confirmOrderForm"),this.paymentsClient=new google.payments.api.PaymentsClient({environment:(t=this.options.initialData.environment)===null||void 0===t?void 0:t.toUpperCase()});let o=this.paymentsClient.createButton({buttonSizeMode:"fill",buttonType:"checkout",onClick:this.onClick.bind(this)});document.getElementById("google-pay-button").appendChild(o)}showErrorMessage(){let e=document.getElementById("betterpayment-google-pay-error");e.style.display="block",e.scrollIntoView({block:"start"})}async onClick(){try{var e,t,o,n,a,i,s,l,r,p,d,c,u,m,h,y,g,_,v,w;let{googlePay:b,...P}=this.options.initialData;if(!b||!P){console.log("no initial data");return}let C=this.options.amount.toFixed(2),E={apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:[{type:"CARD",parameters:{allowedAuthMethods:b.allowedAuthMethods,allowedCardNetworks:b.allowedCardNetworks},tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:b.gateway,gatewayMerchantId:b.gatewayMerchantId}}}],merchantInfo:{merchantId:b.merchantId,merchantName:b.merchantName},transactionInfo:{totalPriceStatus:"FINAL",totalPrice:C,currencyCode:P.currency,checkoutOption:"COMPLETE_IMMEDIATE_PURCHASE"},emailRequired:!0},I=await this.paymentsClient.loadPaymentData(E),S=this.options.billingAddress,k=this.options.shippingAddress,N={googlepay_token:(t=I.paymentMethodData)===null||void 0===t?void 0:(e=t.tokenizationData)===null||void 0===e?void 0:e.token,amount:C,currency:P.currency,postback_url:P.postbackUrl,shipping_costs:P.shippingCosts,vat:P.vat,order_id:P.orderId,merchant_reference:P.orderId+" - "+P.shopName,customer_id:P.customerId,customer_ip:P.customerIp,app_name:P.appName,app_version:P.appVersion,address:(a=S.street)!==null&&void 0!==a?a:null,address2:null,city:(i=S.city)!==null&&void 0!==i?i:null,postal_code:(s=S.zipcode)!==null&&void 0!==s?s:null,state:(l=(o=S.countryState)===null||void 0===o?void 0:o.name)!==null&&void 0!==l?l:null,country:(r=S.country.iso)!==null&&void 0!==r?r:"DE",first_name:(p=S.firstName)!==null&&void 0!==p?p:null,last_name:(d=S.lastName)!==null&&void 0!==d?d:null,email:(c=P.email)!==null&&void 0!==c?c:null,phone:(u=S.phoneNumber)!==null&&void 0!==u?u:null,shipping_address:(m=k.street)!==null&&void 0!==m?m:null,shipping_address2:null,shipping_city:(h=k.city)!==null&&void 0!==h?h:null,shipping_postal_code:(y=k.zipcode)!==null&&void 0!==y?y:null,shipping_state:(g=(n=k.countryState)===null||void 0===n?void 0:n.name)!==null&&void 0!==g?g:null,shipping_country:(_=k.country.iso)!==null&&void 0!==_?_:null,shipping_first_name:(v=k.firstName)!==null&&void 0!==v?v:null,shipping_last_name:(w=k.lastName)!==null&&void 0!==w?w:null},f=await fetch(this.options.processPaymentPath,{method:"POST",body:JSON.stringify(N),headers:{"Content-Type":"application/json"}});if(f.ok){let e=await f.json();0===e.error_code?(document.getElementById("betterpayment_google_pay_transaction_id").value=e.transaction_id,document.getElementById("betterpayment_google_pay_transaction_status").value=e.status,this.orderForm.submit()):this.showErrorMessage()}else this.showErrorMessage()}catch(e){this.showErrorMessage()}}},"[data-google-pay-plugin]")})();