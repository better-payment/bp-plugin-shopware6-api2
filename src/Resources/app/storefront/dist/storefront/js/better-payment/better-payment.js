(()=>{"use strict";let{PluginBaseClass:i}=window,n=["postalAddress","email","phone"];window.PluginManager.register("ApplePayPlugin",class extends i{init(){this.el.addEventListener("click",this.onClick.bind(this)),this.orderForm=document.getElementById("confirmOrderForm")}showErrorMessage(){let i=document.getElementById("betterpayment-apple-pay-error");i.style.display="block",i.scrollIntoView({block:"start"})}onClick(){if(!this.orderForm.reportValidity())return;let i=this.options.initialData,o=this.options.amount;try{let e={countryCode:i.countryCode,currencyCode:i.currency,merchantCapabilities:i.applePay.merchantCapabilities,supportedNetworks:i.applePay.supportedNetworks,total:{label:i.shopName,amount:o},requiredShippingContactFields:n,requiredBillingContactFields:n},l=new ApplePaySession(14,e);l.onvalidatemerchant=()=>{fetch(this.options.validateMerchantPath,{method:"POST"}).then(i=>i.json()).then(i=>{let n=JSON.parse(atob(i.applepay_payment_session_token));l.completeMerchantValidation(n)}).catch(i=>{this.showErrorMessage()})},l.onpaymentmethodselected=()=>{let n={newTotal:{label:i.shopName,amount:o}};l.completePaymentMethodSelection(n)},l.onpaymentauthorized=async n=>{var e,t,a,d,s,p,r,u,v,c,m,y,h,_,g,C,b,S,P,w,f,E,A,N,k,I,M,T,F,L,O,U,B,V,j,D,J,q,R,x,z,G,H,K,Q,W,X,Y,Z,$,ii,io,ie,il,it,ia,id,is,ip,ir,iu,iv,ic,im,iy;let ih={first_name:(W=(t=n.payment)===null||void 0===t?void 0:(e=t.billingContact)===null||void 0===e?void 0:e.givenName)!==null&&void 0!==W?W:null,last_name:(X=(d=n.payment)===null||void 0===d?void 0:(a=d.billingContact)===null||void 0===a?void 0:a.familyName)!==null&&void 0!==X?X:null,address_1:(Y=(r=n.payment)===null||void 0===r?void 0:(p=r.billingContact)===null||void 0===p?void 0:(s=p.addressLines)===null||void 0===s?void 0:s[0])!==null&&void 0!==Y?Y:null,address_2:(Z=(c=n.payment)===null||void 0===c?void 0:(v=c.billingContact)===null||void 0===v?void 0:(u=v.addressLines)===null||void 0===u?void 0:u[1])!==null&&void 0!==Z?Z:null,city:($=(y=n.payment)===null||void 0===y?void 0:(m=y.billingContact)===null||void 0===m?void 0:m.locality)!==null&&void 0!==$?$:null,state:(ii=(_=n.payment)===null||void 0===_?void 0:(h=_.billingContact)===null||void 0===h?void 0:h.administrativeArea)!==null&&void 0!==ii?ii:null,country:(io=(C=n.payment)===null||void 0===C?void 0:(g=C.billingContact)===null||void 0===g?void 0:g.countryCode)!==null&&void 0!==io?io:"DE",postcode:(ie=(S=n.payment)===null||void 0===S?void 0:(b=S.billingContact)===null||void 0===b?void 0:b.postalCode)!==null&&void 0!==ie?ie:null,email:(il=(w=n.payment)===null||void 0===w?void 0:(P=w.shippingContact)===null||void 0===P?void 0:P.emailAddress)!==null&&void 0!==il?il:null,phone:(it=(E=n.payment)===null||void 0===E?void 0:(f=E.shippingContact)===null||void 0===f?void 0:f.phoneNumber)!==null&&void 0!==it?it:null},i_={first_name:(ia=(N=n.payment)===null||void 0===N?void 0:(A=N.shippingContact)===null||void 0===A?void 0:A.givenName)!==null&&void 0!==ia?ia:null,last_name:(id=(I=n.payment)===null||void 0===I?void 0:(k=I.shippingContact)===null||void 0===k?void 0:k.familyName)!==null&&void 0!==id?id:null,address_1:(is=(F=n.payment)===null||void 0===F?void 0:(T=F.shippingContact)===null||void 0===T?void 0:(M=T.addressLines)===null||void 0===M?void 0:M[0])!==null&&void 0!==is?is:null,address_2:(ip=(U=n.payment)===null||void 0===U?void 0:(O=U.shippingContact)===null||void 0===O?void 0:(L=O.addressLines)===null||void 0===L?void 0:L[1])!==null&&void 0!==ip?ip:null,city:(ir=(V=n.payment)===null||void 0===V?void 0:(B=V.shippingContact)===null||void 0===B?void 0:B.locality)!==null&&void 0!==ir?ir:null,state:(iu=(D=n.payment)===null||void 0===D?void 0:(j=D.shippingContact)===null||void 0===j?void 0:j.administrativeArea)!==null&&void 0!==iu?iu:null,country:(iv=(q=n.payment)===null||void 0===q?void 0:(J=q.shippingContact)===null||void 0===J?void 0:J.countryCode)!==null&&void 0!==iv?iv:"DE",postcode:(ic=(x=n.payment)===null||void 0===x?void 0:(R=x.shippingContact)===null||void 0===R?void 0:R.postalCode)!==null&&void 0!==ic?ic:null,email:(im=(G=n.payment)===null||void 0===G?void 0:(z=G.shippingContact)===null||void 0===z?void 0:z.emailAddress)!==null&&void 0!==im?im:null,phone:(iy=(K=n.payment)===null||void 0===K?void 0:(H=K.shippingContact)===null||void 0===H?void 0:H.phoneNumber)!==null&&void 0!==iy?iy:null},ig={applepay_token:btoa(JSON.stringify((Q=n.payment)===null||void 0===Q?void 0:Q.token)),amount:o,currency:i.currency,postback_url:i.postback_url,shipping_costs:i.shippingCosts,vat:i.vat,order_id:i.orderId,merchant_reference:i.orderId+" - "+i.shopName,customer_id:i.customerId,customer_ip:i.customerIp,app_name:i.appName,app_version:i.appVersion,address:ih.address_1,address2:ih.address_2,city:ih.city,postal_code:ih.postcode,state:ih.state,country:ih.country,first_name:ih.first_name,last_name:ih.last_name,email:ih.email,phone:ih.phone,shipping_address:i_.address_1,shipping_address2:i_.address_2,shipping_city:i_.city,shipping_postal_code:i_.postcode,shipping_state:i_.state,shipping_country:i_.country,shipping_first_name:i_.first_name,shipping_last_name:i_.last_name},iC=await fetch(this.options.processPaymentPath,{method:"POST",body:JSON.stringify(ig),headers:{"Content-Type":"application/json"}});if(iC.ok){let i=await iC.json();0===i.error_code?(l.completePayment({status:ApplePaySession.STATUS_SUCCESS}),document.getElementById("betterpayment_apple_pay_transaction_id").value=i.transaction_id,document.getElementById("betterpayment_apple_pay_transaction_status").value=i.status,this.orderForm.submit()):(l.completePayment({status:ApplePaySession.STATUS_FAILURE}),this.showErrorMessage())}else l.completePayment({status:ApplePaySession.STATUS_FAILURE}),this.showErrorMessage()},l.oncancel=i=>{this.showErrorMessage()},l.begin()}catch(i){this.showErrorMessage()}}},"[data-apple-pay-plugin]")})();