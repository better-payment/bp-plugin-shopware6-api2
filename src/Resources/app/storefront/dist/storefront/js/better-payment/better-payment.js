(()=>{"use strict";let{PluginBaseClass:e}=window,t=["postalAddress","email","phone"],{PluginBaseClass:i}=window,n=window.PluginManager;n.register("ApplePayPlugin",class extends e{init(){this.el.addEventListener("click",this.onClick.bind(this)),this.orderForm=document.getElementById("confirmOrderForm")}showErrorMessage(){let e=document.getElementById("betterpayment-apple-pay-error");e.style.display="block",e.scrollIntoView({block:"start"})}onClick(){if(!this.orderForm.reportValidity())return;let e=this.options.initialData,i=this.options.amount;try{let n={countryCode:e.countryCode,currencyCode:e.currency,merchantCapabilities:e.applePay.merchantCapabilities,supportedNetworks:e.applePay.supportedNetworks,total:{label:e.shopName,amount:i},requiredShippingContactFields:t,requiredBillingContactFields:t},o=new ApplePaySession(14,n);o.onvalidatemerchant=()=>{fetch(this.options.validateMerchantPath,{method:"POST"}).then(e=>e.json()).then(e=>{let t=JSON.parse(atob(e.applepay_payment_session_token));o.completeMerchantValidation(t)}).catch(e=>{this.showErrorMessage()})},o.onpaymentmethodselected=()=>{let t={newTotal:{label:e.shopName,amount:i}};o.completePaymentMethodSelection(t)},o.onpaymentauthorized=async t=>{var n,s,a;let l=this.options.billingAddress,r=this.options.shippingAddress,d={applepay_token:btoa(JSON.stringify((n=t.payment)===null||void 0===n?void 0:n.token)),amount:i,currency:e.currency,postback_url:e.postback_url,shipping_costs:e.shippingCosts,vat:e.vat,order_id:e.orderId,merchant_reference:e.orderId+" - "+e.shopName,customer_id:e.customerId,customer_ip:e.customerIp,app_name:e.appName,app_version:e.appVersion,address:l.street,city:l.city,postal_code:l.zipcode,state:(s=l.countryState)===null||void 0===s?void 0:s.name,country:l.country.iso,first_name:l.firstName,last_name:l.lastName,email:e.email,phone:l.phoneNumber,shipping_address:r.street,shipping_city:r.city,shipping_postal_code:r.zipcode,shipping_state:(a=r.countryState)===null||void 0===a?void 0:a.name,shipping_country:r.country.iso,shipping_first_name:r.firstName,shipping_last_name:r.lastName},p=await fetch(this.options.processPaymentPath,{method:"POST",body:JSON.stringify(d),headers:{"Content-Type":"application/json"}});if(p.ok){let e=await p.json();0===e.error_code?(o.completePayment({status:ApplePaySession.STATUS_SUCCESS}),document.getElementById("betterpayment_apple_pay_transaction_id").value=e.transaction_id,document.getElementById("betterpayment_apple_pay_transaction_status").value=e.status,this.orderForm.submit()):(o.completePayment({status:ApplePaySession.STATUS_FAILURE}),this.showErrorMessage())}else o.completePayment({status:ApplePaySession.STATUS_FAILURE}),this.showErrorMessage()},o.oncancel=e=>{this.showErrorMessage()},o.begin()}catch(e){this.showErrorMessage()}}},"[data-apple-pay-plugin]"),n.register("GooglePayPlugin",class extends i{async init(){await new Promise(e=>setTimeout(e,1e3)),this.orderForm=document.getElementById("confirmOrderForm"),this.paymentsClient=new google.payments.api.PaymentsClient({environment:"TEST"});let e=this.paymentsClient.createButton({buttonSizeMode:"fill"});document.getElementById("google-pay-button").appendChild(e),this.el.addEventListener("click",this.onClick.bind(this))}showErrorMessage(){let e=document.getElementById("betterpayment-google-pay-error");e.style.display="block",e.scrollIntoView({block:"start"})}async onClick(){var e,t,i,n,o,s,a,l,r,d,p,u,c,m,h,y,g,v,_,w,b,A,P,C,E,I,S,k,N,f,M,T;let{googlePay:F,...B}=this.options.initialData;if(!F||!B){console.log("no initial data");return}let O=this.options.amount.toFixed(2),D={apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:[{type:"CARD",parameters:{allowedAuthMethods:F.allowedAuthMethods,allowedCardNetworks:F.allowedCardNetworks,billingAddressRequired:!0,billingAddressParameters:{format:"FULL",phoneNumberRequired:!0}},tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:F.gateway,gatewayMerchantId:F.gatewayMerchantId}}}],merchantInfo:{merchantId:F.merchantId,merchantName:F.merchantName},transactionInfo:{totalPriceStatus:"FINAL",totalPrice:O,currencyCode:B.currency,checkoutOption:"COMPLETE_IMMEDIATE_PURCHASE"},emailRequired:!0,shippingAddressRequired:!0,shippingAddressParameters:{phoneNumberRequired:!0}},R=await this.paymentsClient.loadPaymentData(D),U=(t=R.paymentMethodData)===null||void 0===t?void 0:(e=t.info)===null||void 0===e?void 0:e.billingAddress,L={googlepay_token:(n=R.paymentMethodData)===null||void 0===n?void 0:(i=n.tokenizationData)===null||void 0===i?void 0:i.token,amount:O,currency:B.currency,postback_url:B.postbackUrl,shipping_costs:B.shippingCosts,vat:B.vat,order_id:B.orderId,merchant_reference:B.orderId+" - "+B.shopName,customer_id:B.customerId,customer_ip:B.customerIp,app_name:B.appName,app_version:B.appVersion,address:(m=null==U?void 0:U.address1)!==null&&void 0!==m?m:null,address2:(h=null==U?void 0:U.address2)!==null&&void 0!==h?h:null,city:(y=null==U?void 0:U.locality)!==null&&void 0!==y?y:null,postal_code:(g=null==U?void 0:U.postalCode)!==null&&void 0!==g?g:null,state:(v=null==U?void 0:U.administrativeArea)!==null&&void 0!==v?v:null,country:(_=null==U?void 0:U.countryCode)!==null&&void 0!==_?_:"DE",first_name:(w=null==U?void 0:U.name)!==null&&void 0!==w?w:null,last_name:(b=null==U?void 0:U.name)!==null&&void 0!==b?b:null,email:(A=R.email)!==null&&void 0!==A?A:null,phone:(P=null==U?void 0:U.phoneNumber)!==null&&void 0!==P?P:null,shipping_address:(C=(o=R.shippingAddress)===null||void 0===o?void 0:o.address1)!==null&&void 0!==C?C:null,shipping_address2:(E=(s=R.shippingAddress)===null||void 0===s?void 0:s.address2)!==null&&void 0!==E?E:null,shipping_city:(I=(a=R.shippingAddress)===null||void 0===a?void 0:a.locality)!==null&&void 0!==I?I:null,shipping_postal_code:(S=(l=R.shippingAddress)===null||void 0===l?void 0:l.postalCode)!==null&&void 0!==S?S:null,shipping_state:(k=(r=R.shippingAddress)===null||void 0===r?void 0:r.administrativeArea)!==null&&void 0!==k?k:null,shipping_country:(N=(d=R.shippingAddress)===null||void 0===d?void 0:d.countryCode)!==null&&void 0!==N?N:null,shipping_first_name:(f=(p=R.shippingAddress)===null||void 0===p?void 0:p.name)!==null&&void 0!==f?f:null,shipping_last_name:(M=(u=R.shippingAddress)===null||void 0===u?void 0:u.name)!==null&&void 0!==M?M:null,shipping_phone:(T=(c=R.shippingAddress)===null||void 0===c?void 0:c.phoneNumber)!==null&&void 0!==T?T:null},V=await fetch(this.options.processPaymentPath,{method:"POST",body:JSON.stringify(L),headers:{"Content-Type":"application/json"}});if(V.ok){let e=await V.json();0===e.error_code?(document.getElementById("betterpayment_google_pay_transaction_id").value=e.transaction_id,document.getElementById("betterpayment_google_pay_transaction_status").value=e.status,this.orderForm.submit()):this.showErrorMessage()}else this.showErrorMessage()}},"[data-google-pay-plugin]")})();