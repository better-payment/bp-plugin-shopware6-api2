(()=>{"use strict";class t{static ucFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}static lcFirst(t){return t.charAt(0).toLowerCase()+t.slice(1)}static toDashCase(t){return t.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()}static toLowerCamelCase(e,o){let i=t.toUpperCamelCase(e,o);return t.lcFirst(i)}static toUpperCamelCase(e,o){return o?e.split(o).map(e=>t.ucFirst(e.toLowerCase())).join(""):t.ucFirst(e.toLowerCase())}static parsePrimitive(t){try{return/^\d+(.|,)\d+$/.test(t)&&(t=t.replace(",",".")),JSON.parse(t)}catch(e){return t.toString()}}}class e{static isNode(t){return"object"==typeof t&&null!==t&&(t===document||t===window||t instanceof Node)}static hasAttribute(t,o){if(!e.isNode(t))throw Error("The element must be a valid HTML Node!");return"function"==typeof t.hasAttribute&&t.hasAttribute(o)}static getAttribute(t,o){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!1===e.hasAttribute(t,o))throw Error('The required property "'.concat(o,'" does not exist!'));if("function"!=typeof t.getAttribute){if(i)throw Error("This node doesn't support the getAttribute function!");return}return t.getAttribute(o)}static getDataAttribute(o,i){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],l=i.replace(/^data(|-)/,""),a=t.toLowerCamelCase(l,"-");if(!e.isNode(o)){if(n)throw Error("The passed node is not a valid HTML Node!");return}if(void 0===o.dataset){if(n)throw Error("This node doesn't support the dataset attribute!");return}let r=o.dataset[a];if(void 0===r){if(n)throw Error('The required data attribute "'.concat(i,'" does not exist on ').concat(o,"!"));return r}return t.parsePrimitive(r)}static querySelector(t,o){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!e.isNode(t))throw Error("The parent node is not a valid HTML Node!");let n=t.querySelector(o)||!1;if(i&&!1===n)throw Error('The required element "'.concat(o,'" does not exist in parent node!'));return n}static querySelectorAll(t,o){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!e.isNode(t))throw Error("The parent node is not a valid HTML Node!");let n=t.querySelectorAll(o);if(0===n.length&&(n=!1),i&&!1===n)throw Error('At least one item of "'.concat(o,'" must exist in parent node!'));return n}static getFocusableElements(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return t.querySelectorAll('\n            input:not([tabindex^="-"]):not([disabled]):not([type="hidden"]),\n            select:not([tabindex^="-"]):not([disabled]),\n            textarea:not([tabindex^="-"]):not([disabled]),\n            button:not([tabindex^="-"]):not([disabled]),\n            a[href]:not([tabindex^="-"]):not([disabled]),\n            [tabindex]:not([tabindex^="-"]):not([disabled])\n        ')}static getFirstFocusableElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return this.getFocusableElements(t)[0]}static getLastFocusableElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=this.getFocusableElements(t);return e[e.length-1]}}let{PluginBaseClass:o}=window,i=["postalAddress","email","phone"];window.PluginManager.register("ApplePayPlugin",class extends o{init(){this.el.addEventListener("click",this.onClick.bind(this)),this.orderForm=e.querySelector(document,"#confirmOrderForm")}onClick(){if(!this.orderForm.reportValidity())return;let t=this.options.initialData,e=this.options.amount;if(ApplePaySession)try{let o={countryCode:t.countryCode,currencyCode:t.currency,merchantCapabilities:t.applePay.merchantCapabilities,supportedNetworks:t.applePay.supportedNetworks,total:{label:t.shopName,amount:e},requiredShippingContactFields:i,requiredBillingContactFields:i},n=new ApplePaySession(14,o);n.onvalidatemerchant=()=>{fetch(this.options.validateMerchantPath,{method:"POST"}).then(t=>t.json()).then(t=>{let e=JSON.parse(atob(t.applepay_payment_session_token));n.completeMerchantValidation(e)}).catch(t=>{console.error("Error fetching merchant session",t)})},n.onpaymentmethodselected=()=>{let o={newTotal:{label:t.shopName,amount:e}};n.completePaymentMethodSelection(o)},n.onpaymentauthorized=async o=>{var i,l,a,r,s,d,u,p,c,v,m,h,y,g,b,C,_,f,A,w,S,N,T,E,P,F,L,x,q,k,U,M,O,j,I,D,H,J,V,G,R,$,z,B,Z,K,Q,W,X,Y,tt,te,to,ti,tn,tl,ta,tr,ts,td,tu,tp,tc,tv,tm;let th={first_name:(K=(l=o.payment)===null||void 0===l?void 0:(i=l.billingContact)===null||void 0===i?void 0:i.givenName)!==null&&void 0!==K?K:null,last_name:(Q=(r=o.payment)===null||void 0===r?void 0:(a=r.billingContact)===null||void 0===a?void 0:a.familyName)!==null&&void 0!==Q?Q:null,address_1:(W=(u=o.payment)===null||void 0===u?void 0:(d=u.billingContact)===null||void 0===d?void 0:(s=d.addressLines)===null||void 0===s?void 0:s[0])!==null&&void 0!==W?W:null,address_2:(X=(v=o.payment)===null||void 0===v?void 0:(c=v.billingContact)===null||void 0===c?void 0:(p=c.addressLines)===null||void 0===p?void 0:p[1])!==null&&void 0!==X?X:null,city:(Y=(h=o.payment)===null||void 0===h?void 0:(m=h.billingContact)===null||void 0===m?void 0:m.locality)!==null&&void 0!==Y?Y:null,state:(tt=(g=o.payment)===null||void 0===g?void 0:(y=g.billingContact)===null||void 0===y?void 0:y.administrativeArea)!==null&&void 0!==tt?tt:null,country:(te=(C=o.payment)===null||void 0===C?void 0:(b=C.billingContact)===null||void 0===b?void 0:b.countryCode)!==null&&void 0!==te?te:"DE",postcode:(to=(f=o.payment)===null||void 0===f?void 0:(_=f.billingContact)===null||void 0===_?void 0:_.postalCode)!==null&&void 0!==to?to:null,email:(ti=(w=o.payment)===null||void 0===w?void 0:(A=w.shippingContact)===null||void 0===A?void 0:A.emailAddress)!==null&&void 0!==ti?ti:null,phone:(tn=(N=o.payment)===null||void 0===N?void 0:(S=N.shippingContact)===null||void 0===S?void 0:S.phoneNumber)!==null&&void 0!==tn?tn:null},ty={first_name:(tl=(E=o.payment)===null||void 0===E?void 0:(T=E.shippingContact)===null||void 0===T?void 0:T.givenName)!==null&&void 0!==tl?tl:null,last_name:(ta=(F=o.payment)===null||void 0===F?void 0:(P=F.shippingContact)===null||void 0===P?void 0:P.familyName)!==null&&void 0!==ta?ta:null,address_1:(tr=(q=o.payment)===null||void 0===q?void 0:(x=q.shippingContact)===null||void 0===x?void 0:(L=x.addressLines)===null||void 0===L?void 0:L[0])!==null&&void 0!==tr?tr:null,address_2:(ts=(M=o.payment)===null||void 0===M?void 0:(U=M.shippingContact)===null||void 0===U?void 0:(k=U.addressLines)===null||void 0===k?void 0:k[1])!==null&&void 0!==ts?ts:null,city:(td=(j=o.payment)===null||void 0===j?void 0:(O=j.shippingContact)===null||void 0===O?void 0:O.locality)!==null&&void 0!==td?td:null,state:(tu=(D=o.payment)===null||void 0===D?void 0:(I=D.shippingContact)===null||void 0===I?void 0:I.administrativeArea)!==null&&void 0!==tu?tu:null,country:(tp=(J=o.payment)===null||void 0===J?void 0:(H=J.shippingContact)===null||void 0===H?void 0:H.countryCode)!==null&&void 0!==tp?tp:"DE",postcode:(tc=(G=o.payment)===null||void 0===G?void 0:(V=G.shippingContact)===null||void 0===V?void 0:V.postalCode)!==null&&void 0!==tc?tc:null,email:(tv=($=o.payment)===null||void 0===$?void 0:(R=$.shippingContact)===null||void 0===R?void 0:R.emailAddress)!==null&&void 0!==tv?tv:null,phone:(tm=(B=o.payment)===null||void 0===B?void 0:(z=B.shippingContact)===null||void 0===z?void 0:z.phoneNumber)!==null&&void 0!==tm?tm:null},tg={applepay_token:btoa(JSON.stringify((Z=o.payment)===null||void 0===Z?void 0:Z.token)),amount:e,currency:t.currency,postback_url:t.postback_url,shipping_costs:"",vat:"",order_id:t.orderId,merchant_reference:t.orderId+" - "+t.shopName,customer_id:t.customerId,customer_ip:t.customerIp,app_name:t.appName,app_version:t.appVersion,address:th.address_1,address2:th.address_2,city:th.city,postal_code:th.postcode,state:th.state,country:th.country,first_name:th.first_name,last_name:th.last_name,email:th.email,phone:th.phone,shipping_address:ty.address_1,shipping_address2:ty.address_2,shipping_city:ty.city,shipping_postal_code:ty.postcode,shipping_state:ty.state,shipping_country:ty.country,shipping_first_name:ty.first_name,shipping_last_name:ty.last_name},tb=await fetch(this.options.processPaymentPath,{method:"POST",body:JSON.stringify(tg),headers:{"Content-Type":"application/json"}});if(tb.ok){let t=await tb.json();console.log(t),0===t.error_code?(n.completePayment({status:ApplePaySession.STATUS_SUCCESS}),this.orderForm.submit()):(console.error("Payment Gateway request failed:",tb.status,tb.statusText),console.error("Error details:",t),n.completePayment({status:ApplePaySession.STATUS_FAILURE}))}else{let t=await tb.json();console.error("Payment Gateway request failed:",tb.status,tb.statusText),console.error("Error details:",t),n.completePayment({status:ApplePaySession.STATUS_FAILURE})}},n.oncancel=t=>{console.log(t)},n.begin()}catch(t){console.error(t)}}},"[data-apple-pay-plugin]")})();